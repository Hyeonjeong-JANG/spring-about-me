{{> layout/header}}

<!--Ïª§ÎÆ§ÎãàÌã∞ ÏãúÏûë-->
<section id="section01">
    <div class="container">
        <div class="page-wrapper">
            <h3 class="page-title mb-20">
                Ïª§ÎÆ§ÎãàÌã∞ ÏÇ¨Ïó∞Î≥¥Í∏∞
            </h3>

            <div class="page-content">
                <!--Ïª§ÎÆ§ÎãàÌã∞ ÏÉÅÏÑ∏Î≥¥Í∏∞ ÏãúÏûë-->
                <div class="comm-detail">
                    <!--ÏÉÅÏÑ∏Î≥¥Í∏∞ info ÏãúÏûë-->
                    <div class="c-card">
                        <div class="c-card-body comdetail">
                            <!-- <h4 class="card-title">1</h4> -->
                            <div class="breadcrumb mb-20">
                                <a href="#">ÌôàÌôîÎ©¥</a> > <a href="#">Ïª§ÎÆ§ÎãàÌã∞</a> > <a href="#"
                                                                                class="active main-color">{{comm.commDTO.category}}</a>
                            </div>
                            <h4 class="card-title">{{comm.commDTO.title}}</h4>
                            <div class="community-cartegory detail">
                                <div class="user-info">
                                    <figure><img src="{{comm.commDTO.writerProfileImage}}" alt="ÌöåÏõêÏù¥ÎØ∏ÏßÄ"></figure>
                                    <span>{{comm.commDTO.writerName}}</span><span
                                        class="time">{{comm.commDTO.timeAgo}}</span></div>
                                <div class="actions">
                                    <div class="right-actions">
                                        <button class=" defalut-btn" onclick="clip()"><i
                                                class="fa-regular fa-share-nodes"></i><span>Í≥µÏú†ÌïòÍ∏∞</span></button>
                                        <div class="dropdown">
                                            <button class="drop-toggle"><i class="fa-regular fa-ellipsis-vertical"></i>
                                            </button>
                                            <div class="dropdown-menu">
                                                <button class="dropdown-item">Ïã†Í≥†ÌïòÍ∏∞</button>
                                                <button class="dropdown-item">Î∂ÅÎßàÌÅ¨ÌïòÍ∏∞</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--dropdown ÏãúÏûë..-->

                            <!--dropdown ÎÅù-->
                            <p class="card-text">{{comm.commDTO.content}}</p>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <br>
                            <div class="click-wrapper mb-20">
                                <button>üí¨ 2Î™ÖÏù¥ ÏßàÎ¨∏ÎãµÎ≥Ä Ï∂îÏ≤ú</button>
                                <button>‚ù§ Í≥µÍ∞ê2Í∞ú</button>
                            </div>

                        </div>
                    </div>
                    <!--ÏÉÅÏÑ∏Î≥¥Í∏∞ info ÎÅù-->

                    <!--ÎåìÍ∏Ä Ï†úÎ™© ÏãúÏûë-->
                    <hr>
                    <br>

                    {{#comm.replies}}
                        {{#userRole}}
                            <!--Ï†ÑÎ¨∏Í∞Ä ÎåìÍ∏Ä ÏãúÏûë-->
                            <div class="expert-answer mb-20">
                                <h3 class="page-title mb-20">Ï†ÑÎ¨∏ÎãµÎ≥Ä <span class="main-color">1</span> Í∞úÍ∞Ä Îã¨Î†∏Ïñ¥Ïöî.</h3>
                                <div class="expert-answer-header main-background">
                                    <div class="info">
                                        <img src="/images/user.png" alt="ÏÉÅÎã¥ÏÇ¨ ÏÇ¨ÏßÑ">
                                        <div class="answer-text">
                                            <div class="name">{{name}} ÏÉÅÎã¥ÏÇ¨</div>
                                            <div class="details">2Í∏â Ïã¨Î¶¨ÏÉÅÎã¥ÏÇ¨ ¬∑ 20Î∂Ñ Ï†Ñ</div>
                                        </div>
                                    </div>
                                    <button class="defalut-btn main-background active-background">ÏÉÅÎã¥ Î∞õÏïÑÎ≥¥Í∏∞</button>
                                </div>
                                <div class="content">
                                    <br>
                                    <h5 class="page-title">ÏÜåÍ∞úÍ∏Ä</h5>
                                    <p class="detail-answer-reply mb-20">{{introduction}}</p>
                                    <br>
                                    <h5 class="page-title">üìù ÏÇ¨Î°Ä ÏöîÏïΩ</h5>
                                    <p class="detail-answer-reply mb-20">{{summary}}</p>
                                    <br>
                                    <h5 class="page-title">üí° ÏõêÏù∏ Î∂ÑÏÑù</h5>
                                    <p class="detail-answer-reply mb-20">{{causeAnalysis}}</p>
                                    <br>
                                    <h5 class="page-title">üîß ÎåÄÏ≤ò Î∞©Ïïà Ï†úÏãú</h5>
                                    <p class="detail-answer-reply mb-20">{{solution}}</p>
                                    <div class="bottom-content">
                                        <div class="click-wrapper">
                                            <button>üí¨ ÎèÑÏõÄÎèºÏöî</button>
                                        </div>
                                        <div class="actions">
                                            <div class="right-actions" style="display: flex">
                                                <button class=" defalut-btn" onclick="clip()"><i
                                                        class="fa-regular fa-share-nodes"></i><span>Í≥µÏú†ÌïòÍ∏∞</span></button>
                                                <div class="dropdown">
                                                    <button class="drop-toggle"><i
                                                            class="fa-regular fa-ellipsis-vertical"></i>
                                                    </button>
                                                    <div class="dropdown-menu">
                                                        <button class="dropdown-item">Ïã†Í≥†ÌïòÍ∏∞</button>
                                                        <button class="dropdown-item">Î∂ÅÎßàÌÅ¨ÌïòÍ∏∞</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--dropdown ÏãúÏûë..-->

                                <!--dropdown ÎÅù-->
                            </div>
                            <!--Ï†ÑÎ¨∏Í∞Ä ÎåìÍ∏Ä ÎÅù-->
                        {{/userRole}}
                        {{^userRole}}
                            <!--ÏùºÎ∞òÏù∏ ÎåìÍ∏Ä ÏãúÏûë-->
                            <div class="c-card ">
                                <div class="c-card-body detail mb-20">
                                    <div class="community-cartegory">
                                        <div class="user-info">
                                            <figure><img src="" alt="ÌöåÏõêÏù¥ÎØ∏ÏßÄ">ÏùºÎ∞òÏù∏ Ïù¥ÎØ∏ÏßÄ</figure>
                                            <span>{{name}}</span>
                                        </div>
                                    </div>
                                    <p class="card-text mb-20">{{content}}</p>

                                    <div class="bottom-content">
                                        <div class="click-wrapper">
                                            <button>üí¨ ÎèÑÏõÄÎèºÏöî</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--ÏùºÎ∞òÏù∏ ÎåìÍ∏Ä ÎÅù-->
                        {{/userRole}}
                    {{/comm.replies}}

                    <div class="comment-section mb-50">
                        <input type="text" placeholder="Îî∞ÎúªÌïú ÎåìÍ∏ÄÏùÑ ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî" name="content" id="content">
                        {{^sessionUser}}
                            <button class="main-background defalut-btn">Í≤åÏãú</button>
                        {{/sessionUser}}
                        {{#sessionUser}}
                            {{#isExpert}}
                                <button class="main-background defalut-btn"
                                        onclick="openNewWindow({{comm.commDTO.id}})">
                                    Ï†ÑÎ¨∏Í∞Ä ÎåìÍ∏Ä
                                    Í≤åÏãú
                                </button>
                            {{/isExpert}}
                            {{#isClient}}
                                <button class="main-background defalut-btn"
                                        onclick="clientReplyAction({{comm.commDTO.id}})">Í≤åÏãú
                                </button>
                            {{/isClient}}
                        {{/sessionUser}}
                    </div>

                    <hr>
                    <script src="../js/communutiyDetailExpert.js"></script>
                    <!--Ï†ÑÎ¨∏Í∞Ä ÎåìÍ∏Ä ÎÅù-->
                    <!--ÎåìÍ∏Ä ÏÑπÏÖò ÏãúÏûë-->
                    <!--Í∞ôÏùÄ Ïπ¥ÌÖåÍ≥†Î¶¨ Îã§Î•∏ Í∏Ä ÏÇ¥Ìé¥Î≥¥Í∏∞ ÏãúÏûë-->
                    <br>
                    <h3 class="page-title mb-20">{{comm.commDTO.category}}Ïùò Îã§Î•∏ Í∏Ä ÏÇ¥Ìé¥Î≥¥Í∏∞</h3>
                    <!-- Îã§Î•∏ Í∏Ä -->
                    {{#comm.relatedComms}}
                        <div class="c-card">
                            <div class="c-card-body detail">
                                <a href="/comm-detail/{{id}}">
                                    <h4 class="card-title mb-10">{{title}}</h4>
                                    <div class="community-cartegory">
                                        <div class="category main-color">{{category}}</div>
                                        <div class="user-info">
                                            <figure><img src="{{writerProfileImage}}" alt="ÌöåÏõêÏù¥ÎØ∏ÏßÄ"></figure>
                                            <span>{{writerName}}</span>
                                        </div>
                                    </div>
                                    <p class="card-text mb-20">{{content}}</p>
                                </a>
                                <div class="link-wrapper">
                                    <a href="#" class="card-link like">‚ù§<em class="count">1</em></a>
                                    <a href="#" class="card-link reply">üíå<em class="count">2</em></a>
                                </div>
                                {{#expertReplies}}
                                    <div class="expert-reply">
                                        <div class="expert-reply-info mb-10">
                                            <figure><img src="{{writerProfileImage}}" alt="Ï†ÑÎ¨∏Í∞Ä Ïù¥ÎØ∏ÏßÄÍ∞Ä Îì§Ïñ¥Í∞à ÏûêÎ¶¨"></figure>
                                            <span class="expert-reply-name active-color">{{writerName}}ÎãòÏùò Ï†ÑÎ¨∏ÎãµÎ≥Ä</span>
                                        </div>
                                        <p class="reply-content">
                                            {{solution}}
                                        </p>
                                    </div>
                                {{/expertReplies}}
                            </div>

                        </div>
                    {{/comm.relatedComms}}
                </div>
                <!--ÎãµÎ≥Ä Ï§ë Ï†ÑÎ¨∏Í∞ÄÍ∞Ä Î¶¨Ìîå Îã¨ÏïÑÏ§Ä Í≤É ÏãúÏûë-->
            </div>
            <!--Ïª§ÎÆ§ÎãàÌã∞ ÏÉÅÏÑ∏Î≥¥Í∏∞ ÎÅù-->
        </div>
    </div>
    </div>
</section>
<script>
    $(document).ready(function () {

        // ÎìúÎ°≠Îã§Ïö¥ Î∞ïÏä§
        $('.dropdown').click(function () {
            $(this).find('.dropdown-menu').toggleClass('show');

        });

        // Ìï¥Îãπ Ï£ºÏÜåÎßÅÌÅ¨ Ï†ÄÏû•
        function clip() {
            var url = window.location.href; // Ï£ºÏÜåÏ∞ΩÏùò URLÏùÑ Í∞ÄÏ†∏Ïò¥
            var textarea = document.createElement("textarea");
            document.body.appendChild(textarea);
            textarea.value = url;
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
            alert("ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.");
            console.log(url);
        };
    });

    // Ï†ÑÎ¨∏Í∞Ä ÎåìÍ∏Ä Îã¨Í∏∞ Ï∞Ω Ïó¥Í∏∞
    function openNewWindow(id) {
        fetch(`/api/comm-detail/${id}/has-expert-reply`)
                .then(response => response.json())
                .then(data => {
                    if (data) {
                        alert('Ïù¥ÎØ∏ Ï†ÑÎ¨∏ÎãµÎ≥ÄÏù¥ Îã¨Î¶∞ Í∏ÄÏûÖÎãàÎã§.');
                    } else {
                        var url = "/expert/reply?id=" + id;
                        var windowFeatures = "width=600, height=900, scrollbars=yes";
                        window.open(url, "_blank", windowFeatures);
                    }
                })
                .catch(error => {
                    console.error('Error checking expert reply:', error);
                    alert('Ï†ÑÎ¨∏ÎãµÎ≥ÄÏùÑ ÌôïÏù∏ÌïòÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                });
    }

    // ÏùºÎ∞òÏù∏ ÎåìÍ∏Ä Îã¨Í∏∞
    function clientReplyAction(id) {
        const content = document.getElementById('content').value;

        const newReply = {
            id: id,
            content: content
        };

        fetch('/client-reply/complete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(newReply),
        })
                .then(response => {
                    if (response.ok) {
                        alert('ÎåìÍ∏ÄÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Îì±Î°ùÎêòÏóàÏäµÎãàÎã§.');
                        window.location.reload();
                    } else {
                        alert('ÎåìÍ∏Ä Îì±Î°ù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                    }
                })
                .catch(error => {
                    console.error('Error posting client reply:', error);
                    alert('ÎåìÍ∏Ä Îì±Î°ù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                });
    }

</script>
<!--Ïª®ÌÖêÏ∏† ÎÅù-->
</div>
<!--Ïª§ÎÆ§ÎãàÌã∞ ÎÅù-->
{{> layout/footer}}

