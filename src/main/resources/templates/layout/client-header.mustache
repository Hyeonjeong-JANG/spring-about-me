<!-- 헤더 시작 -->
<header class="header-ex">
    <div class="container">
        <div class="header">
            <div class="header-left">
                <div class="logo">
                    <a href="/">
                        <img src="/images/main_logo.svg" alt="Main Logo">
                    </a>
                </div>
                <div class="menu">
                    <ul>
                        <li><a href="/comm">커뮤니티</a></li>
                        <li><a href="/client/findExpert">전문가 찾기</a></li>
                    </ul>
                </div>
            </div>
            <div class="header-right">
                {{#sessionUser}}
                    <ul>
                        <li><a href="/logout">로그아웃</a></li>
                        <li><a href="#!" class="icon"><i class="fas fa-search"></i></a></li>
                        <li><a href="/client/mypage" class="icon"><i class="far fa-user"></i></a></li>
                    </ul>
                {{/sessionUser}}
                {{^sessionUser}}
                    <ul>
                        <li><a href="/login">로그인</a></li>
                        <li><a href="/join">회원가입</a></li>
                        <li><a href="#!" class="icon"><i class="fas fa-search"></i></a></li>
                        <li><a href="#!" class="icon"><i class="far fa-user"></i></a></li>
                    </ul>
                {{/sessionUser}}
            </div>
        </div>
    </div>
</header>
<div id="clientEvent"></div>
<script>
    // 클라이언트에게 알림
    function initializeClientEventSource() {
        if (!window.clientEventSource) {
            const clientEventSource = new EventSource("/clientEmitter");

            clientEventSource.onmessage = (event) => {
                const div = document.createElement("div");
                div.textContent = `Event received: ${event.data}`;
                document.getElementById("clientEvent").appendChild(div);
            };

            clientEventSource.onerror = (error) => {
                console.error("Error occurred:", error);
                clientEventSource.close();
                // 연결이 끊어졌을 때 재연결 시도 (백오프 전략 적용 가능)
                setTimeout(() => {
                    initializeClientEventSource();
                }, 3000); // 3초 후 재연결 시도
            };

            window.clientEventSource = clientEventSource;
        }
    }

    initializeClientEventSource();
</script>
<!-- 헤더 끝 -->